<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quicksilver Playground</title>
    <style>
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; background: #0d1117; color: #c9d1d9; height: 100vh; display: flex; flex-direction: column; }
        header { background: #161b22; border-bottom: 1px solid #30363d; padding: 12px 24px; display: flex; align-items: center; justify-content: space-between; }
        header h1 { font-size: 18px; color: #58a6ff; }
        header h1 span { color: #8b949e; font-weight: 400; }
        .toolbar { display: flex; gap: 8px; }
        .btn { background: #21262d; border: 1px solid #30363d; color: #c9d1d9; padding: 6px 16px; border-radius: 6px; cursor: pointer; font-size: 14px; transition: background 0.2s; }
        .btn:hover { background: #30363d; }
        .btn-primary { background: #238636; border-color: #2ea043; }
        .btn-primary:hover { background: #2ea043; }
        .main { flex: 1; display: flex; overflow: hidden; }
        .editor-pane, .output-pane { flex: 1; display: flex; flex-direction: column; }
        .editor-pane { border-right: 1px solid #30363d; }
        .pane-header { background: #161b22; padding: 8px 16px; font-size: 13px; color: #8b949e; border-bottom: 1px solid #30363d; }
        #editor { flex: 1; background: #0d1117; color: #c9d1d9; font-family: 'JetBrains Mono', 'Fira Code', monospace; font-size: 14px; padding: 16px; border: none; outline: none; resize: none; tab-size: 2; line-height: 1.6; }
        #output { flex: 1; background: #0d1117; color: #c9d1d9; font-family: 'JetBrains Mono', 'Fira Code', monospace; font-size: 13px; padding: 16px; overflow-y: auto; white-space: pre-wrap; line-height: 1.6; }
        .output-line { padding: 2px 0; }
        .output-line.error { color: #f85149; }
        .output-line.info { color: #58a6ff; }
        .output-line.success { color: #3fb950; }
        .examples { display: flex; gap: 4px; }
        .example-btn { background: transparent; border: 1px solid #30363d; color: #8b949e; padding: 4px 10px; border-radius: 12px; cursor: pointer; font-size: 12px; }
        .example-btn:hover { color: #c9d1d9; border-color: #58a6ff; }
        .status { font-size: 12px; color: #8b949e; padding: 4px 16px; background: #161b22; border-top: 1px solid #30363d; display: flex; justify-content: space-between; }
    </style>
</head>
<body>
    <header>
        <h1>âš¡ Quicksilver <span>Playground</span></h1>
        <div class="toolbar">
            <div class="examples">
                <button class="example-btn" onclick="loadExample('hello')">Hello World</button>
                <button class="example-btn" onclick="loadExample('fibonacci')">Fibonacci</button>
                <button class="example-btn" onclick="loadExample('classes')">Classes</button>
                <button class="example-btn" onclick="loadExample('closures')">Closures</button>
                <button class="example-btn" onclick="loadExample('destructuring')">Destructuring</button>
            </div>
            <button class="btn btn-primary" onclick="runCode()" id="runBtn">â–¶ Run (Ctrl+Enter)</button>
            <button class="btn" onclick="clearOutput()">Clear</button>
            <button class="btn" onclick="shareCode()">Share</button>
        </div>
    </header>
    <div class="main">
        <div class="editor-pane">
            <div class="pane-header">editor.js</div>
            <textarea id="editor" spellcheck="false">// Welcome to Quicksilver Playground!
// A memory-safe JavaScript runtime written in Rust.

function fibonacci(n) {
    if (n <= 1) return n;
    return fibonacci(n - 1) + fibonacci(n - 2);
}

for (let i = 0; i < 10; i++) {
    console.log(`fib(${i}) = ${fibonacci(i)}`);
}
</textarea>
        </div>
        <div class="output-pane">
            <div class="pane-header">Output</div>
            <div id="output"></div>
        </div>
    </div>
    <div class="status">
        <span id="statusText">Ready</span>
        <span>Quicksilver v0.1.0 | WASM Runtime</span>
    </div>

    <script>
        const EXAMPLES = {
            hello: `// Hello World
console.log("Hello from Quicksilver! âš¡");

let name = "World";
console.log(\`Greetings, \${name}!\`);

// Template literals
let items = [1, 2, 3, 4, 5];
console.log(\`Sum: \${items.reduce((a, b) => a + b, 0)}\`);`,

            fibonacci: `// Fibonacci with memoization
const memo = {};
function fib(n) {
    if (n <= 1) return n;
    if (memo[n]) return memo[n];
    memo[n] = fib(n - 1) + fib(n - 2);
    return memo[n];
}

for (let i = 0; i <= 15; i++) {
    console.log(\`fib(\${i}) = \${fib(i)}\`);
}`,

            classes: `// ES6 Classes
class Animal {
    constructor(name, sound) {
        this.name = name;
        this.sound = sound;
    }

    speak() {
        console.log(\`\${this.name} says \${this.sound}!\`);
    }
}

class Dog extends Animal {
    constructor(name) {
        super(name, "Woof");
    }

    fetch(item) {
        console.log(\`\${this.name} fetches the \${item}!\`);
    }
}

const dog = new Dog("Rex");
dog.speak();
dog.fetch("ball");
console.log(dog instanceof Animal);`,

            closures: `// Closures and Higher-Order Functions
function makeCounter(start = 0) {
    let count = start;
    return {
        increment: () => ++count,
        decrement: () => --count,
        value: () => count
    };
}

const counter = makeCounter(10);
console.log(counter.increment()); // 11
console.log(counter.increment()); // 12
console.log(counter.decrement()); // 11
console.log("Final:", counter.value());

// Array methods
const numbers = [1, 2, 3, 4, 5, 6, 7, 8, 9, 10];
const evens = numbers.filter(n => n % 2 === 0);
const doubled = evens.map(n => n * 2);
console.log("Doubled evens:", doubled);`,

            destructuring: `// Destructuring & Spread
const [first, second, ...rest] = [1, 2, 3, 4, 5];
console.log("First:", first);
console.log("Rest:", rest);

const { name, age, ...extra } = {
    name: "Alice",
    age: 30,
    city: "Wonderland",
    role: "Explorer"
};
console.log(\`\${name}, age \${age}\`);

// Optional chaining & nullish coalescing
const config = { db: { host: "localhost" } };
console.log(config?.db?.host ?? "default");
console.log(config?.cache?.host ?? "no-cache");`
        };

        function loadExample(name) {
            document.getElementById('editor').value = EXAMPLES[name] || '';
        }

        function clearOutput() {
            document.getElementById('output').innerHTML = '';
        }

        function addOutput(text, type = '') {
            const line = document.createElement('div');
            line.className = 'output-line' + (type ? ' ' + type : '');
            line.textContent = text;
            document.getElementById('output').appendChild(line);
        }

        async function runCode() {
            const code = document.getElementById('editor').value;
            const btn = document.getElementById('runBtn');
            const status = document.getElementById('statusText');

            clearOutput();
            btn.disabled = true;
            btn.textContent = 'â³ Running...';
            status.textContent = 'Executing...';

            try {
                if (typeof window.__quicksilver_eval === 'function') {
                    // WASM runtime available
                    const result = window.__quicksilver_eval(code);
                    if (result.output) {
                        result.output.forEach(line => addOutput(line));
                    }
                    if (result.error) {
                        addOutput('Error: ' + result.error, 'error');
                    }
                    status.textContent = `Completed in ${result.time_ms || 0}ms`;
                } else {
                    // Fallback: use browser JS eval (demo mode)
                    addOutput('âš¡ Running in browser demo mode (WASM runtime not loaded)', 'info');
                    addOutput('', '');
                    const logs = [];
                    const mockConsole = {
                        log: (...args) => logs.push(args.map(String).join(' ')),
                        error: (...args) => logs.push('ERROR: ' + args.map(String).join(' ')),
                        warn: (...args) => logs.push('WARN: ' + args.map(String).join(' ')),
                    };
                    const fn = new Function('console', code);
                    fn(mockConsole);
                    logs.forEach(line => addOutput(line));
                    status.textContent = 'Completed (demo mode)';
                }
            } catch (e) {
                addOutput(e.toString(), 'error');
                status.textContent = 'Error';
            }

            btn.disabled = false;
            btn.textContent = 'â–¶ Run (Ctrl+Enter)';
        }

        function shareCode() {
            const code = document.getElementById('editor').value;
            const encoded = btoa(encodeURIComponent(code));
            const url = window.location.origin + window.location.pathname + '#code=' + encoded;
            navigator.clipboard.writeText(url).then(() => {
                addOutput('ðŸ“‹ Share URL copied to clipboard!', 'success');
            });
        }

        // Load shared code from URL hash
        if (window.location.hash.startsWith('#code=')) {
            try {
                const encoded = window.location.hash.slice(6);
                document.getElementById('editor').value = decodeURIComponent(atob(encoded));
            } catch (e) {}
        }

        // Keyboard shortcut
        document.getElementById('editor').addEventListener('keydown', (e) => {
            if ((e.ctrlKey || e.metaKey) && e.key === 'Enter') {
                e.preventDefault();
                runCode();
            }
            // Tab support
            if (e.key === 'Tab') {
                e.preventDefault();
                const ta = e.target;
                const start = ta.selectionStart;
                ta.value = ta.value.substring(0, start) + '  ' + ta.value.substring(ta.selectionEnd);
                ta.selectionStart = ta.selectionEnd = start + 2;
            }
        });
    </script>
</body>
</html>
